// Nasconde tutte le animazioni e salva lo stile originale
function swiperAnimateCache(swiper) {
  for (let j = 0; j < swiper.slides.length; j++) {
    const allBoxes = swiper.slides[j].querySelectorAll(".ani");
    for (let i = 0; i < allBoxes.length; i++) {
      const el = allBoxes[i];
      // Salva stile originale in un attributo personalizzato
      if (el.attributes["style"]) {
        el.setAttribute("swiper-animate-style-cache", el.attributes["style"].value);
      } else {
        el.setAttribute("swiper-animate-style-cache", " ");
      }
      // Nasconde l'elemento
      el.style.visibility = "hidden";
    }
  }
}

// Esegue le animazioni sugli elementi visibili
function swiperAnimate(swiper) {
  clearSwiperAnimate(swiper);

  const currentSlide = swiper.slides[swiper.activeIndex];
  const animElements = currentSlide.querySelectorAll(".ani");

  for (let i = 0; i < animElements.length; i++) {
    const el = animElements[i];
    el.style.visibility = "visible";

    // Aggiungi classe di effetto animato
    const effect = el.getAttribute("swiper-animate-effect") || "";
    el.className += " " + effect + " animated";

    // Stile originale + durata/ritardo animazione
    let style = el.getAttribute("style") || "";

    const duration = el.getAttribute("swiper-animate-duration") || "";
    if (duration) {
      style += `animation-duration:${duration}; -webkit-animation-duration:${duration};`;
    }

    const delay = el.getAttribute("swiper-animate-delay") || "";
    if (delay) {
      style += `animation-delay:${delay}; -webkit-animation-delay:${delay};`;
    }

    el.setAttribute("style", style);
  }
}

// Ripristina lo stato iniziale (nasconde e rimuove animazioni)
function clearSwiperAnimate(swiper) {
  for (let j = 0; j < swiper.slides.length; j++) {
    const allBoxes = swiper.slides[j].querySelectorAll(".ani");

    for (let i = 0; i < allBoxes.length; i++) {
      const el = allBoxes[i];

      // Ripristina lo stile originale
      if (el.hasAttribute("swiper-animate-style-cache")) {
        el.setAttribute("style", el.getAttribute("swiper-animate-style-cache"));
      }

      el.style.visibility = "hidden";

      // Rimuove classi animate
      el.className = el.className.replace("animated", " ");

      const effect = el.getAttribute("swiper-animate-effect");
      if (effect) {
        el.className = el.className.replace(effect, " ");
      }
    }
  }
}
